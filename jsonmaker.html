<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Item Selector - Scratch Style with Backpack</title>
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background-color: #f0f0f0;
      display: flex;
      justify-content: center;
      padding: 20px;
      height: 100vh;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      color: #00A1FF;
      font-size: 3rem;
      margin-bottom: 20px;
      text-align: center;
    }

    .container {
      display: flex;
      align-items: flex-start;
      width: 100%;
      max-width: 1200px;
      flex-wrap: wrap;
      justify-content: center;
      gap: 50px;
    }

    /* Slots Area */
    .slots {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 20px;
      padding-top: 30px;
    }

    .slot {
      width: 150px;
      height: 150px;
      background-color: #3A3A3A;
      border-radius: 12px;
      border: 4px solid #FF8C00;
      color: white;
      font-size: 1.5rem;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      position: relative;
      text-transform: uppercase;
    }

    .slot.empty {
      background-color: #595959;
      color: #C2C2C2;
    }

    .slot.filled {
      background-color: #333333;
      color: white;
    }

    .item-palette {
      display: flex;
      flex-direction: column;
      gap: 20px;
      width: 200px;
      padding: 20px;
      background-color: #fff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
      position: sticky;
      top: 20px;
    }

    .item {
      padding: 15px;
      background-color: #FF8C00;
      color: white;
      font-size: 1.1rem;
      text-align: center;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s;
      user-select: none;
    }

    .item:hover {
      background-color: #FF7A00;
    }

    .item.dragging {
      opacity: 0.5;
    }

    .backpack-contents {
      display: none;
      background-color: #fff;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 10px;
      border-radius: 12px;
      margin-top: 20px;
    }

    .backpack-contents ul {
      list-style-type: none;
      padding: 0;
    }

    .backpack-contents li {
      padding: 5px 0;
    }

    .backpack-contents button {
      background-color: #FF8C00;
      color: white;
      padding: 8px 15px;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }

    .backpack-contents button:hover {
      background-color: #FF7A00;
    }

    .download-btn {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #FF8C00;
      color: white;
      border-radius: 12px;
      cursor: pointer;
      border: none;
    }

    .download-btn:hover {
      background-color: #E67800;
    }

  </style>
</head>
<body>

  <h1>Item Setup</h1>

  <div class="container">
    <!-- Slots Area -->
    <div class="slots">
      <div class="slot empty" id="back" ondrop="drop(event)" ondragover="allowDrop(event)">Back</div>
      <div class="slot empty" id="leftHand" ondrop="drop(event)" ondragover="allowDrop(event)">Left Hand</div>
      <div class="slot empty" id="rightHand" ondrop="drop(event)" ondragover="allowDrop(event)">Right Hand</div>
      <div class="slot empty" id="leftHip" ondrop="drop(event)" ondragover="allowDrop(event)">Left Hip</div>
      <div class="slot empty" id="rightHip" ondrop="drop(event)" ondragover="allowDrop(event)">Right Hip</div>
    </div>

    <!-- Item Palette -->
    <div class="item-palette" id="itemPalette"></div>
  </div>

  <!-- Download JSON Button -->
  <button class="download-btn" onclick="downloadJSON()">Download JSON</button>

  <script>
    const dataURL = 'https://raw.githubusercontent.com/blankzz-metadata/animalcompany/main/stuff.json';
    const itemData = {
      back: {},
      leftHand: {},
      rightHand: {},
      leftHip: {},
      rightHip: {}
    };

    let allItems = [];
    let currentSlot = null;

    fetch(dataURL)
      .then(res => res.json())
      .then(items => {
        allItems = items;
        populateItemPalette(items);
      });

    // Populate the item palette with draggable items
    function populateItemPalette(items) {
      const itemPalette = document.getElementById('itemPalette');
      items.forEach(item => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'item';
        itemDiv.id = item.id;
        itemDiv.textContent = item.id;
        itemDiv.setAttribute('draggable', 'true');
        itemDiv.setAttribute('ondragstart', 'drag(event)');
        itemPalette.appendChild(itemDiv);
      });
    }

    // Allow drop on the slots
    function allowDrop(event) {
      event.preventDefault();
      const slot = event.target;
      if (!slot.classList.contains('empty')) {
        slot.classList.add('over');
      }
    }

    // Dragging item
    function drag(event) {
      event.dataTransfer.setData("text", event.target.id);
      event.target.classList.add('dragging');
    }

    // Dropping the item into a slot
    function drop(event) {
      event.preventDefault();
      const itemId = event.dataTransfer.getData("text");
      const item = document.getElementById(itemId);
      const slot = event.target;

      if (slot.classList.contains('slot') && slot.classList.contains('empty')) {
        slot.textContent = item.textContent;
        slot.classList.remove('empty');
        slot.classList.add('filled');
        item.style.display = "none";  // Hide item once dropped

        // If it's a backpack, show its contents area
        if (itemId === 'item_backpack') {
          showBackpackContents(slot);
        }
      }
    }

    // Show the backpack contents area
    function showBackpackContents(slot) {
      const backpackContents = document.createElement('div');
      backpackContents.classList.add('backpack-contents');
      slot.appendChild(backpackContents);

      backpackContents.innerHTML = `
        <h4>Backpack Contents</h4>
        <ul id="backpackItems"></ul>
        <div>
          <button onclick="addItemToBackpack('${slot.id}')">Add Item to Backpack</button>
        </div>
      `;
      backpackContents.style.display = 'block';
    }

    // Add item to the backpack
    function addItemToBackpack(slotId) {
      const selectedItem = allItems[Math.floor(Math.random() * allItems.length)]; // Randomly add an item for now
      const selectedItemElem = document.createElement('li');
      selectedItemElem.textContent = selectedItem.id;
      document.getElementById('backpackItems').appendChild(selectedItemElem);
      
      if (!itemData[slotId].children) {
        itemData[slotId].children = [];
      }
      
      itemData[slotId].children.push({ itemID: selectedItem.id });
    }

    // Download JSON functionality
    function downloadJSON() {
      const jsonData = {};

      // Populate the slots with current items
      for (let slot in itemData) {
        if (itemData[slot].itemID) {
          jsonData[slot] = itemData[slot];
        } else {
          jsonData[slot] = {};
        }
      }

      const jsonString = JSON.stringify(jsonData, null, 2);
      const blob = new Blob([jsonString], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'item_configuration.json';
      link.click();
    }
  </script>

</body>
</html>
